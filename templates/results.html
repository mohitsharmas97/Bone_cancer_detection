{% extends "base.html" %}

{% block title %}Results - Bone Cancer Detection{% endblock %}

{% block content %}
<div class="container">
    <div class="results-header">
        <h2>Analysis Results</h2>
        <p>AI-powered bone cancer detection analysis</p>
    </div>

    <!-- Classification Result -->
    <div
        class="result-card {% if prediction.prediction_class == 'cancer' %}result-cancer{% else %}result-normal{% endif %}">
        <div class="result-icon">
            {% if prediction.prediction_class == 'cancer' %}
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z">
                </path>
            </svg>
            {% else %}
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            {% endif %}
        </div>
        <div class="result-content">
            <h3 class="result-status">
                {% if prediction.prediction_class == 'cancer' %}
                Cancer Detected
                {% else %}
                Normal (No Cancer Detected)
                {% endif %}
            </h3>
            <p class="result-confidence">
                Confidence: {{ "%.2f"|format(prediction.confidence_cancer * 100 if prediction.prediction_class ==
                'cancer' else prediction.confidence_normal * 100) }}%
            </p>
        </div>
    </div>

    <!-- Confidence Scores -->
    <div class="confidence-section">
        <h3>Confidence Scores</h3>
        <div class="confidence-bars">
            <div class="confidence-item">
                <div class="confidence-label">
                    <span>Cancer</span>
                    <span class="confidence-value">{{ "%.2f"|format(prediction.confidence_cancer * 100) }}%</span>
                </div>
                <div class="confidence-bar">
                    <div class="confidence-fill confidence-fill-cancer"
                        style="width: {{ prediction.confidence_cancer * 100 }}%"></div>
                </div>
            </div>
            <div class="confidence-item">
                <div class="confidence-label">
                    <span>Normal</span>
                    <span class="confidence-value">{{ "%.2f"|format(prediction.confidence_normal * 100) }}%</span>
                </div>
                <div class="confidence-bar">
                    <div class="confidence-fill confidence-fill-normal"
                        style="width: {{ prediction.confidence_normal * 100 }}%"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Images -->
    <div class="images-section">
        <h3>Visual Analysis</h3>
        <div class="images-grid">
            <div class="image-card">
                <h4>Original X-Ray</h4>
                <img src="{{ url_for('static', filename=original_image) }}" alt="Original X-Ray">
            </div>
            <div class="image-card">
                <h4>GradCAM Heatmap</h4>
                <img src="{{ url_for('static', filename=heatmap_image) }}" alt="GradCAM Heatmap">
                <p class="image-caption">Regions highlighted in red/yellow influenced the classification</p>
            </div>
        </div>
    </div>

    <!-- Actions -->
    <div class="actions-section">
        <a href="{{ url_for('reports.generate', prediction_id=prediction.id) }}" class="btn btn-primary">
            <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z">
                </path>
            </svg>
            Generate PDF Report
        </a>
        <a href="{{ url_for('predict.dashboard') }}" class="btn btn-secondary">
            <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12">
                </path>
            </svg>
            Upload Another Image
        </a>
    </div>

    <!-- Disclaimer -->
    <div class="disclaimer-box">
        <h4>
            <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z">
                </path>
            </svg>
            Medical Disclaimer
        </h4>
        <p>
            This AI analysis is for screening purposes only and should NOT be used as the sole basis for medical
            decisions.
            Always consult qualified medical professionals for diagnosis and treatment.
            The system has approximately 97% validation accuracy but false positives and false negatives are possible.
        </p>
    </div>
</div>
{% endblock %}