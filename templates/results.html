{% extends "base.html" %}

{% block title %}Results - Bone Cancer Detection{% endblock %}

{% block content %}
<div class="container">
    <div class="results-header">
        <h2>Analysis Results</h2>
        <p>AI-powered bone cancer detection analysis</p>
    </div>

    <!-- Classification Result -->
    <div
        class="result-card {% if prediction.prediction_class == 'cancer' %}result-cancer{% else %}result-normal{% endif %}">
        <div class="result-icon">
            {% if prediction.prediction_class == 'cancer' %}
            ‚ö†Ô∏è
            {% else %}
            ‚úÖ
            {% endif %}
        </div>
        <div class="result-content">
            <h3 class="result-status">
                {% if prediction.prediction_class == 'cancer' %}
                Cancer Detected
                {% else %}
                Normal (No Cancer Detected)
                {% endif %}
            </h3>
            <p class="result-confidence">
                Confidence: {{ "%.2f"|format(prediction.confidence_cancer * 100 if prediction.prediction_class ==
                'cancer' else prediction.confidence_normal * 100) }}%
            </p>
        </div>
    </div>

    <!-- Confidence Scores -->
    <div class="confidence-section">
        <h3>Confidence Scores</h3>
        <div class="confidence-bars">
            <div class="confidence-item">
                <div class="confidence-label">
                    <span>Cancer</span>
                    <span class="confidence-value">{{ "%.2f"|format(prediction.confidence_cancer * 100) }}%</span>
                </div>
                <div class="confidence-bar">
                    <div class="confidence-fill confidence-fill-cancer"
                        style="width: {{ prediction.confidence_cancer * 100 }}%"></div>
                </div>
            </div>
            <div class="confidence-item">
                <div class="confidence-label">
                    <span>Normal</span>
                    <span class="confidence-value">{{ "%.2f"|format(prediction.confidence_normal * 100) }}%</span>
                </div>
                <div class="confidence-bar">
                    <div class="confidence-fill confidence-fill-normal"
                        style="width: {{ prediction.confidence_normal * 100 }}%"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Images -->
    <div class="images-section">
        <h3>Visual Analysis</h3>
        <div class="images-grid">
            <div class="image-card">
                <h4>Original X-Ray</h4>
                <img src="{{ url_for('static', filename=original_image) }}" alt="Original X-Ray">
            </div>
            <div class="image-card">
                <h4>GradCAM Heatmap</h4>
                <img src="{{ url_for('static', filename=heatmap_image) }}" alt="GradCAM Heatmap">
                <p class="image-caption">Regions highlighted in red/yellow influenced the classification</p>
            </div>
        </div>
    </div>

    <!-- Actions -->
    <div class="actions-section">
        <a href="{{ url_for('reports.generate', prediction_id=prediction.id) }}" class="btn btn-primary">
            üìÑ Generate PDF Report
        </a>
        <a href="{{ url_for('predict.dashboard') }}" class="btn btn-secondary">
            Upload Another Image
        </a>
    </div>

    <!-- Disclaimer -->
    <div class="disclaimer-box">
        <h4>‚ö†Ô∏è Medical Disclaimer</h4>
        <p>
            This AI analysis is for screening purposes only and should NOT be used as the sole basis for medical
            decisions.
            Always consult qualified medical professionals for diagnosis and treatment.
            The system has ~97% validation accuracy but false positives and false negatives are possible.
        </p>
    </div>
</div>
{% endblock %}